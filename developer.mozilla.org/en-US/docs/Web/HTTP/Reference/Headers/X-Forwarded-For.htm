<!DOCTYPE html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="https://developer.mozilla.org/favicon.ico"><link rel="alternate icon" type="image/svg+xml" href="https://developer.mozilla.org/favicon.svg"><link rel="apple-touch-icon" href="https://developer.mozilla.org/apple-touch-icon.528534bba673c38049c2.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="https://developer.mozilla.org/manifest.f42880861b394dd4dc9b.json"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"><title>X-Forwarded-For header</title><link rel="alternate" title="X-Forwarded-For header" href="https://developer.mozilla.org/de/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" hreflang="de"><link rel="alternate" title="X-Forwarded-For" href="https://developer.mozilla.org/es/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" hreflang="es"><link rel="alternate" title="X-Forwarded-For" href="https://developer.mozilla.org/ja/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" hreflang="ja"><link rel="alternate" title="X-Forwarded-For" href="https://developer.mozilla.org/ko/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" hreflang="ko"><link rel="alternate" title="X-Forwarded-For" href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" hreflang="pt"><link rel="alternate" title="X-Forwarded-For" href="https://developer.mozilla.org/ru/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" hreflang="ru"><link rel="alternate" title="X-Forwarded-For" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" hreflang="zh"><link rel="alternate" title="X-Forwarded-For" href="https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" hreflang="zh-Hant"><link rel="alternate" title="X-Forwarded-For header" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Forwarded-For" hreflang="en"><link rel="preload" as="font" type="font/woff2" href="/static/media/Inter.var.c2fe3cb2b7c746f7966a.woff2" crossorigin=""><link rel="alternate" type="application/rss+xml" title="MDN Blog RSS Feed" href="https://developer.mozilla.org/en-US/blog/rss.xml"><meta name="description" content="The HTTP X-Forwarded-For (XFF) request header is a de-facto standard header for identifying the originating IP address of a client connecting to a web server through a proxy server."><meta property="og:url" content="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Forwarded-For"><meta property="og:title" content="X-Forwarded-For header - HTTP | MDN"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:description" content="The HTTP X-Forwarded-For (XFF) request header is a de-facto standard header for identifying the originating IP address of a client connecting to a web server through a proxy server."><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.d893525a4fb5fb1f67a2.png"><meta property="og:image:type" content="image/png"><meta property="og:image:height" content="1080"><meta property="og:image:width" content="1920"><meta property="og:image:alt" content="The MDN Web Docs logo, featuring a blue accent color, displayed on a solid black background."><meta property="og:site_name" content="MDN Web Docs"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="MozDevNet"><link rel="canonical" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Forwarded-For"><style media="print">.article-actions-container,.document-toc-container,.language-menu,.main-menu-toggle,.on-github,.page-footer,.place,.sidebar,.top-banner,.top-navigation-main,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style></head><body><div id="root"><div class="page-wrapper  category-http document-page"><div class="main-wrapper"><main id="content" class="main-content  "><article class="main-page-content" lang="en-US"><header><h1>X-Forwarded-For header</h1></header><div class="section-content"><p>The HTTP <strong><code>X-Forwarded-For</code></strong> (XFF) <a href="https://developer.mozilla.org/en-US/docs/Glossary/Request_header">request header</a> is a de-facto standard header for identifying the originating IP address of a client connecting to a web server through a <a href="https://developer.mozilla.org/en-US/docs/Glossary/Proxy_server">proxy server</a>.</p>
<p>A standardized version of this header is the HTTP <a href="Forwarded.htm"><code>Forwarded</code></a> header, although it's much less frequently used.</p>
<div class="notecard warning">
<p><strong>Warning:</strong>
Improper use of this header can be a security risk.
For details, see the <a href="#security_and_privacy_concerns">Security and privacy concerns</a> section.</p>
</div>
<figure class="table-container"><table class="properties">
  <tbody>
    <tr>
      <th scope="row">Header type</th>
      <td><a href="https://developer.mozilla.org/en-US/docs/Glossary/Request_header">Request header</a></td>
    </tr>
    <tr>
      <th scope="row"><a href="https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_request_header">Forbidden request header</a></th>
      <td>No</td>
    </tr>
  </tbody>
</table></figure></div><section aria-labelledby="syntax"><h2 id="syntax"><a href="#syntax">Syntax</a></h2><div class="section-content"><div class="code-example"><div class="example-header"><span class="language-name">http</span></div><pre class="brush: http notranslate"><code>X-Forwarded-For: &lt;client&gt;, &lt;proxy&gt;
X-Forwarded-For: &lt;client&gt;, &lt;proxy&gt;, …, &lt;proxyN&gt;
</code></pre></div>
<p>For example, an IPV6 client IP in the first header, an IPV4 client IP in the second header, and an IPV4 client IP and an IPV6 proxy IP in the third example:</p>
<div class="code-example"><div class="example-header"><span class="language-name">http</span></div><pre class="brush: http notranslate"><code>X-Forwarded-For: 2001:db8:85a3:8d3:1319:8a2e:370:7348
X-Forwarded-For: 203.0.113.195
X-Forwarded-For: 203.0.113.195, 2001:db8:85a3:8d3:1319:8a2e:370:7348
</code></pre></div></div></section><section aria-labelledby="directives"><h2 id="directives"><a href="#directives">Directives</a></h2><div class="section-content"><dl>
<dt id="client"><a href="#client"><code>&lt;client&gt;</code></a></dt>
<dd>
<p>The client IP address.</p>
</dd>
<dt id="proxy"><a href="#proxy"><code>&lt;proxy&gt;</code></a></dt>
<dd>
<p>A proxy IP address.
If a request goes through multiple proxies, the IP addresses of each successive proxy are listed.
This means that the rightmost IP address is the IP address of the most recent proxy and the leftmost IP address is the address of the originating client (assuming well-behaved client and proxies).</p>
</dd>
</dl></div></section><section aria-labelledby="description"><h2 id="description"><a href="#description">Description</a></h2><div class="section-content"><p>When a client connects directly to a server, the client's IP address is sent to the server and is often written to server access logs.
If a client connection passes through any forward or reverse proxies, the server only sees the final proxy's IP address, which is often of little use.
That's especially true if the final proxy is a load balancer which is part of the same deployment as the server.
To provide a more useful client IP address to the server, the <code>X-Forwarded-For</code> request header is used.</p>
<p>For detailed guidance on using <code>X-Forwarded-For</code>, see the <a href="#parsing">Parsing</a> and <a href="#selecting_an_ip_address">Selecting an IP address</a> sections.</p></div></section><section aria-labelledby="security_and_privacy_concerns"><h3 id="security_and_privacy_concerns"><a href="#security_and_privacy_concerns">Security and privacy concerns</a></h3><div class="section-content"><p>This header exposes privacy-sensitive information by design, such as the IP address of the client.
Therefore, the user's privacy must be kept in mind when using this header.</p>
<p>If you know that all proxies in the request chain are trusted (i.e., you control them) and are configured correctly, the parts of the header added by your proxies can be trusted.
If any proxy is malicious or misconfigured, any part of the header not added by a trusted proxy may be spoofed or may have an unexpected format or contents.
If the server can be directly connected to from the internet — even if it is also behind a trusted reverse proxy — <strong>no part</strong> of the <code>X-Forwarded-For</code> IP list can be considered trustworthy or safe for security-related uses.</p>
<p>Any security-related use of <code>X-Forwarded-For</code> (such as for rate limiting or IP-based access control) <em>must only</em> use IP addresses added by a trusted proxy.
Using untrustworthy values can result in rate-limiter avoidance, access-control bypass, memory exhaustion, or other negative security or availability consequences.</p>
<p>Leftmost (untrusted) values must only be used for cases where there is no negative impact from using spoofed values.</p></div></section><section aria-labelledby="parsing"><h3 id="parsing"><a href="#parsing">Parsing</a></h3><div class="section-content"><p>Improper parsing of the <code>X-Forwarded-For</code> header may have a negative security impact with consequences as described in the previous section.
For this reason, the following points should be considered when parsing the header values.</p>
<p>There may be multiple <code>X-Forwarded-For</code> headers present in a request.
The IP addresses in these headers must be treated as a single list, starting with the first IP address of the first header and continuing to the last IP address of the last header.
There are two ways of making this single list:</p>
<ul>
<li>Join the <code>X-Forwarded-For</code> full header values with commas and then split by comma into a list, or</li>
<li>split each <code>X-Forwarded-For</code> header by comma into lists and then join the lists.</li>
</ul>
<p>It is insufficient to use only one of multiple <code>X-Forwarded-For</code> headers.</p>
<p>Some reverse proxies will automatically join multiple <code>X-Forwarded-For</code> headers into one, but it is safer not to assume that this is the case.</p></div></section><section aria-labelledby="selecting_an_ip_address"><h3 id="selecting_an_ip_address"><a href="#selecting_an_ip_address">Selecting an IP address</a></h3><div class="section-content"><p>When selecting an address, the full list of IPs (from all <code>X-Forwarded-For</code> headers) must be used.</p>
<p>When choosing the <code>X-Forwarded-For</code> IP address closest to the client (untrustworthy and <em>not</em> for security-related purposes), the first IP from the leftmost that is <em>a valid address</em> and <em>not private/internal</em> should be selected.</p>
<div class="notecard note">
<p><strong>Note:</strong>
We say "a valid address" above because spoofed values may not be actual IP addresses.
Additionally, we say "not internal/private" because clients may have used proxies on their internal network, which may have added addresses from the <a href="https://en.wikipedia.org/wiki/Private_network" class="external" target="_blank">private IP space</a>.</p>
</div>
<p>When choosing the first <em>trustworthy</em> <code>X-Forwarded-For</code> client IP address, additional configuration is required.
There are two common methods:</p>
<dl>
<dt id="trusted_proxy_count"><a href="#trusted_proxy_count">Trusted proxy count</a></dt>
<dd>
<p>The count of reverse proxies between the internet and the server is configured.
The <code>X-Forwarded-For</code> IP list is searched from the rightmost by that count minus one.
For example, if there is only one reverse proxy, that proxy will add the client's IP address, so the rightmost address should be used.
If there are three reverse proxies, the last two IP addresses will be internal.</p>
</dd>
<dt id="trusted_proxy_list"><a href="#trusted_proxy_list">Trusted proxy list</a></dt>
<dd>
<p>The IPs or IP ranges of the trusted reverse proxies are configured.
The <code>X-Forwarded-For</code> IP list is searched from the rightmost, skipping all addresses that are on the trusted proxy list.
The first non-matching address is the target address.</p>
</dd>
</dl>
<p>The first trustworthy <code>X-Forwarded-For</code> IP address may belong to an untrusted intermediate proxy rather than the actual client, but it is the only IP suitable to identify a client for security purposes.</p></div></section><section aria-labelledby="examples"><h2 id="examples"><a href="#examples">Examples</a></h2><div class="section-content"></div></section><section aria-labelledby="client_and_proxy_ips"><h3 id="client_and_proxy_ips"><a href="#client_and_proxy_ips">Client and proxy IPs</a></h3><div class="section-content"><p>From the following <code>X-Forwarded-For</code> request header, we can infer that the client IP address is <code>203.0.113.195</code>, and the request has passed through two proxies.
The first proxy has an IPv6 address of <code>2001:db8:85a3:8d3:1319:8a2e:370:7348</code> and the last proxy in the request chain has an IPv4 address of <code>198.51.100.178</code>:</p>
<div class="code-example"><div class="example-header"><span class="language-name">http</span></div><pre class="brush: http notranslate"><code>X-Forwarded-For: 203.0.113.195,2001:db8:85a3:8d3:1319:8a2e:370:7348,198.51.100.178
</code></pre></div></div></section><section aria-labelledby="specifications"><h2 id="specifications"><a href="#specifications">Specifications</a></h2><div class="section-content"><p>Not part of any current specification. The standardized version of this header is <a href="Forwarded.htm"><code>Forwarded</code></a>.</p></div></section><section aria-labelledby="see_also"><h2 id="see_also"><a href="#see_also">See also</a></h2><div class="section-content"><ul>
<li><a href="X-Forwarded-Host.htm"><code>X-Forwarded-Host</code></a>, <a href="X-Forwarded-Proto.htm"><code>X-Forwarded-Proto</code></a> headers</li>
<li><a href="Via.htm"><code>Via</code></a></li>
<li><a href="Forwarded.htm"><code>Forwarded</code></a></li>
<li><a href="https://httptoolkit.com/blog/what-is-x-forwarded-for/" class="external" target="_blank">What is X-Forwarded-For and when can you trust it?</a> httptoolkit.com (2024)</li>
</ul></div></section></article></main></div></div></div></body></html>